# main.py - Gesti√≥n de estudiantes con men√∫

def leer_estudiantes(archivo):
    try:
        with open(archivo, "r") as f:
            lineas = f.readlines()
        
        estudiantes = []
        for linea in lineas:
            try:
                nombre, calificacion = linea.strip().split(",")
                estudiantes.append((nombre, float(calificacion)))
            except ValueError:
                print(f"‚ö†Ô∏è L√≠nea con formato incorrecto: {linea.strip()}")
        return estudiantes

    except FileNotFoundError:
        print(f"‚ùå El archivo '{archivo}' no existe.")
        return []


def calcular_promedio(estudiantes):
    if not estudiantes:
        return 0
    total = sum(calificacion for _, calificacion in estudiantes)
    return total / len(estudiantes)


def guardar_reporte(estudiantes, archivo_reporte, promedio):
    with open(archivo_reporte, "w") as f:
        for nombre, calificacion in estudiantes:
            f.write(f"{nombre},{calificacion}\n")
        f.write(f"Promedio general: {promedio:.1f}\n")
    print(f"‚úÖ Reporte guardado en '{archivo_reporte}'")


def agregar_estudiante(archivo):
    nombre = input("Ingrese el nombre del estudiante: ")
    while True:
        try:
            calificacion = float(input("Ingrese la calificaci√≥n (0-100): "))
            if 0 <= calificacion <= 100:
                break
            else:
                print("‚ö†Ô∏è La calificaci√≥n debe estar entre 0 y 100.")
        except ValueError:
            print("‚ö†Ô∏è Por favor ingrese un n√∫mero v√°lido.")

    with open(archivo, "a") as f:
        f.write(f"{nombre},{calificacion}\n")
    print(f"‚úÖ {nombre} agregado con √©xito.")


def mostrar_estudiantes(archivo):
    estudiantes = leer_estudiantes(archivo)
    if not estudiantes:
        print("‚ö†Ô∏è No hay estudiantes registrados.")
        return
    print("\nüìã Lista de estudiantes:")
    for i, (nombre, calificacion) in enumerate(estudiantes, start=1):
        print(f"{i}. {nombre} - {calificacion}")


# -------------------
# FLUJO PRINCIPAL CON MEN√ö
# -------------------
ARCHIVO_ESTUDIANTES = "estudiantes.txt"
ARCHIVO_REPORTE = "reporte.txt"

while True:
    print("\nüìö MEN√ö DE GESTI√ìN DE ESTUDIANTES")
    print("1. Ver promedio general")
    print("2. Agregar nuevo estudiante")
    print("3. Generar reporte")
    print("4. Mostrar estudiantes")
    print("5. Salir")
    
    opcion = input("Seleccione una opci√≥n: ")

    if opcion == "1":
        estudiantes = leer_estudiantes(ARCHIVO_ESTUDIANTES)
        if estudiantes:
            promedio = calcular_promedio(estudiantes)
            print(f"üìä Promedio actual: {promedio:.1f}")
        else:
            print("‚ö†Ô∏è No hay datos para calcular el promedio.")

    elif opcion == "2":
        agregar_estudiante(ARCHIVO_ESTUDIANTES)

    elif opcion == "3":
        estudiantes = leer_estudiantes(ARCHIVO_ESTUDIANTES)
        if estudiantes:
            promedio = calcular_promedio(estudiantes)
            guardar_reporte(estudiantes, ARCHIVO_REPORTE, promedio)
        else:
            print("‚ö†Ô∏è No hay datos para generar el reporte.")

    elif opcion == "4":
        mostrar_estudiantes(ARCHIVO_ESTUDIANTES)

    elif opcion == "5":
        print("üëã Saliendo del programa...")
        break

    else:
        print("‚ö†Ô∏è Opci√≥n no v√°lida. Intente de nuevo.")